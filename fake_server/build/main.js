require("source-map-support/register"),module.exports=function(e){var t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s(s.s=7)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t,s){const n=s(1),a=new n.Schema({email:{type:String,required:!0,max:50,unique:!0},pass:{type:String,required:!0,min:6},fname:{type:String,required:!0,max:50},lname:{type:String,required:!0,max:50},idcard:{type:String,min:13,max:13},lineid:{type:String,max:50},phone:{type:String,required:!0,min:10,max:10}},{timestamps:!0});e.exports=n.model("User",a)},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("crypto-js")},function(e,t,s){const n=s(1),a=new n.Schema({amount:{type:Number,min:1,max:9999,required:!0},hno:{type:String,max:30,required:!0},no:{type:String,max:30,required:!0},lane:{type:String,max:50,required:!0},district:{type:String,max:50,required:!0},area:{type:String,max:50,required:!0},province:{type:String,max:50,required:!0},zipcode:{type:String,max:5,required:!0},user_id:{type:String,required:!0}},{timestamps:!0});e.exports=n.model("Beds",a)},function(e,t,s){const n=s(1),a=new n.Schema({date:{type:Date,required:!0},bed_id:{type:String,required:!0},user_id:{type:String,required:!0}},{timestamps:!0});e.exports=n.model("Bedsdealing",a)},function(e,t,s){e.exports=s(8)},function(e,t,s){"use strict";s.r(t);const n=s(0),a=n(),i=s(1),r=s(3),o=s(9),d=s(10),u=s(11),c=s(12);var p=s(13);r.config(),a.use(p()),i.connect(process.env.MONGO_URL).then(()=>console.log()).catch(e=>{console.log(e)}),a.use(n.json()),a.use("/users",o),a.use(d),a.use(u),a.use(c),a.listen(process.env.PORT||8888,()=>{console.log("Backend server is running! on port 8888")}),t.default=a},function(e,t,s){const{findById:n}=s(2),a=s(2),i=s(4);s(3).config();const r=s(0).Router();r.get("/:id",async(e,t)=>{try{const s=await a.findById(e.params.id);s?t.status(201).json({status:!0,message:"ไอดีที่เรียกถูกต้อง",info:s}):t.status(203).json({status:!1,message:"ไอดีที่เรียกไม่ถูกต้อง"})}catch(e){console.log(e),t.status(500).json(e)}}),r.put("/:id",async(e,t)=>{try{const s=await a.findByIdAndUpdate(e.params.id,{$set:e.body},{new:!0});t.status(200).json({status:!0,message:"อัพเดทข้อมูลสำเร็จ",info:s})}catch(e){t.status(500).json({message:"อัพเดทข้อมูลไม่สำเร็จ กรุณาลองใหม่ภายหลัง"})}}),r.put("/changepass/:id",async(e,t)=>{try{const s=await a.findById(e.params.id),n=await i.AES.decrypt(s.pass,process.env.PASS_SEC);if(await n.toString(i.enc.Utf8)==e.body.oldpass){const s=await i.AES.encrypt(e.body.pass,process.env.PASS_SEC).toString();await a.findByIdAndUpdate(e.params.id,{pass:s});t.json({status:!0,message:"เปลี่ยนรหัสผ่านสำเร็จ"})}else t.json({status:!1,message:"รหัสผ่านไม่ถูกต้อง กรุณาลองใหม่อีกครั้ง"})}catch(e){t.status(500).json({message:"อัพเดทข้อมูลไม่สำเร็จ กรุณาลองใหม่ภายหลัง"})}}),e.exports=r},function(e,t,s){const n=["pass"];function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){r(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e,t){if(null==e)return{};var s,n,a=function(e,t){if(null==e)return{};var s,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)s=i[n],t.indexOf(s)>=0||(a[s]=e[s]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)s=i[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}const d=s(0).Router(),u=s(2),c=s(4);d.post("/register",async(e,t)=>{try{const s=await u.findOne({email:e.body.email}),n=await u.findOne({idcard:e.body.idcard}),a=await new u({email:e.body.email,pass:c.AES.encrypt(e.body.pass,process.env.PASS_SEC).toString(),fname:e.body.fname,lname:e.body.lname,idcard:e.body.idcard,lineid:e.body.lineid,phone:e.body.phone});if(s)t.status(203).json({status:!1,message:"อีเมลนี้มีในระบบอยู่แล้ว"});else if(n)t.status(203).json({status:!1,message:"เลขบัตรประจำตัวตัวมีการใช้ซ้ำ"});else{await a.save();t.status(200).json({status:!0,message:"ลงทะเบียนสำเร็จ!"})}}catch(e){t.status(500).json({status:!1,message:"เกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),d.post("/login",async(e,t)=>{try{const s=await u.findOne({email:e.body.email});if(s){const a=c.AES.decrypt(s.pass,process.env.PASS_SEC);if(a.toString(c.enc.Utf8)!==e.body.pass)t.status(203).json({status:!1,message:"รหัสผ่านไม่ถูกต้อง กรุณาลองใหม่อีกครั้ง"});else{const e=s._doc,{pass:a}=e,r=o(e,n);t.status(200).json({status:!0,message:"เข้าสู่ระบบสำเร็จ",info:i({},r)})}}else t.status(203).json({status:!1,message:"อีเมลไม่มีอยู่ในระบบ กรุณาลองใหม่อีกครั้ง"})}catch(e){t.status(500).json({status:!1,message:"เกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),e.exports=d},function(e,t,s){const n=s(5),a=s(2),i=s(6),r=s(0).Router();r.post("/beds",async(e,t)=>{try{const s=await new n({amount:e.body.amount,hno:e.body.hno,no:e.body.no,lane:e.body.lane,district:e.body.district,area:e.body.area,province:e.body.province,zipcode:e.body.zipcode,user_id:e.body.user_id});await s.save();t.status(203).json({status:!0,message:"ลงทะเบียนเตียงสำเร็จ!"})}catch(e){t.status(500).json({status:!1,message:"เกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),r.get("/bedsbyusers/:id",async(e,t)=>{try{const r=await n.find({user_id:e.params.id}),o=await a.find(),d=await i.find();var s=[];for(let e=0;e<r.length;e++){let t,n=[];for(let s=0;s<o.length;s++)r[e].user_id==o[s]._id+""&&(t=o[s]);for(let t=0;t<d.length;t++)r[e]._id==d[t].bed_id&&n.push(d[t]);s.push({_id:r[e]._id,amount:r[e].amount,hno:r[e].hno,no:r[e].no,lane:r[e].lane,district:r[e].district,area:r[e].area,province:r[e].province,zipcode:r[e].zipcode,user_id:r[e].user_id,createdAt:r[e].createdAt,updatedAt:r[e].updatedAt,user:t,bedsdealing:n})}0===s.length?t.status(203).json({status:!1,message:"ไม่มีข้อมูล!"}):t.status(203).json({status:!0,message:"การค้นหาสำเร็จ!",info:{bed:s}})}catch(e){t.status(500).json({status:!1,message:"เกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),r.get("/beds/:id",async(e,t)=>{try{const i=await n.findById(e.params.id),r=await a.find();var s=[];let o;for(let e=0;e<r.length;e++)i.user_id==r[e]._id+""&&(o=r[e]);s.push({_id:i._id,amount:i.amount,hno:i.hno,no:i.no,lane:i.lane,district:i.district,area:i.area,province:i.province,zipcode:i.zipcode,user_id:i.user_id,createdAt:i.createdAt,updatedAt:i.updatedAt,user:o}),0==s.length?t.status(203).json({status:!1,message:"ไม่มีข้อมูล!"}):t.status(200).json({status:!0,message:"การค้นหาสำเร็จ!",info:s})}catch(e){t.status(404).json({status:!1,message:"ไม่มีข้อมูลหรือเกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),r.get("/bedsready",async(e,t)=>{try{const e=await n.find({amount:{$gt:0}}),s=await a.find(),i=[];for(let t=0;t<e.length;t++){let n;for(let a=0;a<s.length;a++)e[t].user_id==s[a]._id+""&&(n=s[a]);i.push({_id:e[t]._id,amount:e[t].amount,hno:e[t].hno,no:e[t].no,lane:e[t].lane,district:e[t].district,area:e[t].area,province:e[t].province,zipcode:e[t].zipcode,user_id:e[t].user_id,createdAt:e[t].createdAt,updatedAt:e[t].updatedAt,user:n})}0===i.length?t.status(203).json({status:!1,message:"ไม่มีเตียงที่พร้อมให้บริการ!"}):t.status(200).json({status:!0,message:"การค้นหาสำเร็จ!",info:i})}catch(e){t.status(404).json({status:!1,message:"ไม่มีข้อมูลหรือเกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),e.exports=r},function(e,t,s){const n=s(6),a=s(2),i=s(5),r=s(0).Router();s(1);s(3).config(),r.get("/bedsdealing/:id",async(e,t)=>{try{const s=await n.find({_id:e.params.id}),r=await i.find(),o=await a.find();let d,u,c=[];for(let e=0;e<o.length;e++)s[0].user_id==o[e]._id+""&&(d=o[e]);for(let e=0;e<r.length;e++)s[0].bed_id==r[e]._id+""&&(u=r[e]);c.push({_id:s[0]._id,bed_id:s[0].bed_id,user_id:s[0].user_id,date:s[0].date,user:d,bed:u}),0===c.length?t.status(203).json({status:!1,message:"ไม่มีข้อมูล!"}):t.status(200).json({status:!0,message:"การค้นหาสำเร็จ!",info:c})}catch(e){}}),r.get("/bedsdealing",async(e,t)=>{try{const e=await n.find(),s=await a.find();let i=[];for(let t=0;t<e.length;t++){let n;for(let a=0;a<s.length;a++)e[t].user_id==s[a]._id+""&&(n=s[a]);i.push({_id:e[t]._id,bed_id:e[t].bed_id,user_id:e[t].user_id,date:e[t].date,user:n})}0===i.length?t.status(203).json({status:!1,message:"ไม่มีข้อมูล!"}):t.status(200).json({status:!0,message:"การค้นหาสำเร็จ!",info:i})}catch(e){}}),r.post("/bedsdealing",async(e,t)=>{try{const s=await new n({date:new Date(e.body.date),bed_id:e.body.bed_id,user_id:e.body.user_id}),a=await i.findById(e.body.bed_id);if(0===a.amount)t.status(201).json({status:!1,message:"ไม่สามารถจองได้ เนื่องจากเตียงเต็ม"});else{await i.findByIdAndUpdate(e.body.bed_id,{$set:{amount:a.amount-1}},{new:!0}),await s.save();t.status(200).json({status:!0,message:"จองสำเร็จ"})}}catch(e){t.status(500).json({status:!1,message:"เกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),r.get("/bedsdealingbybeds/:id",async(e,t)=>{try{const s=await n.find({bed_id:e.params.id}),i=await a.find();let r=[];for(let e=0;e<s.length;e++){let t;for(let n=0;n<i.length;n++)s[e].user_id==i[n]._id+""&&(t=i[n]);r.push({_id:s[e]._id,bed_id:s[e].bed_id,user_id:s[e].user_id,date:s[e].date,user:t})}0===r.length?t.status(203).json({status:!1,message:"ไม่มีข้อมูล!"}):t.status(203).json({status:!0,message:"การค้นหาสำเร็จ!",info:r})}catch(e){t.status(500).json({status:!1,message:"เกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),r.get("/bedsdealingbyusers/:id",async(e,t)=>{try{const s=await n.find({user_id:e.params.id}),i=await a.find();let r=[];for(let e=0;e<s.length;e++){let t;for(let n=0;n<i.length;n++)s[e].user_id==i[n]._id+""&&(t=i[n]);r.push({_id:s[e]._id,bed_id:s[e].bed_id,user_id:s[e].user_id,date:s[e].date,user:t})}0===r.length?t.status(203).json({status:!1,message:"ไม่มีข้อมูล!"}):t.status(203).json({status:!0,message:"การค้นหาสำเร็จ!",info:r})}catch(e){t.status(500).json({status:!1,message:"เกิดข้อผิดพลาดกรุณาลงทะเบียนอีกครั้งภายหลัง"})}}),e.exports=r},function(e,t){e.exports=require("cors")}]);
//# sourceMappingURL=main.map